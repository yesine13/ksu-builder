name: A50 Mint KSU 3.1.0 FINAL FIX
on:
  workflow_dispatch:

jobs:
  patch:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Tools
        run: sudo apt-get update && sudo apt-get install -y wget zip git

      - name: Download Ready Kernel & KSU Source
        run: |
          # تحميل ملف الكرنل الجاهز (19.9MB) مباشرة
          wget https://github.com/FreshROMs/android_kernel_samsung_exynos9610_mint/releases/download/xbeta-1413_a50_20250729_064506/MintBeta-1413.A11.AOSP-Enforcing-KSU_A50.CI.zip -O mint_ready.zip
          # تحميل سورس KSU 3.1.0
          wget https://github.com/tiann/KernelSU/archive/refs/tags/v3.1.0.zip -O ksu_source.zip

      - name: Inject Patch and WebUI
        run: |
          unzip mint_ready.zip -d final_work
          cd final_work
          # تفعيل الأوامر التي تحول الحالة إلى Working وتفتح WebUI
          sed -i 's/do.devicecheck=1/do.devicecheck=0/g' anykernel.sh
          echo "patch_overlayfs=1" >> anykernel.sh
          echo "ksu_webui=1" >> anykernel.sh
          # إعادة ضغط كل الملفات بما فيها الكرنل الأصلي
          zip -r9 ../A50-FINAL-KSU-3.1.0.zip *

      - name: Upload Final ZIP
        uses: actions/upload-artifact@v4
        with:
          name: A50-KSU-3.1.0-Fixed-Final
          path: A50-FINAL-KSU-3.1.0.zip
