name: A50 Mint KSU 1.0.3 Action Fix
on:
  workflow_dispatch:

jobs:
  patch:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Tools
        run: sudo apt-get update && sudo apt-get install -y wget zip git

      - name: Download Files
        run: |
          # الرابط الذي أرسلته أنت للكرنل (19.9MB)
          wget -O kernel.zip "https://github.com/FreshROMs/android_kernel_samsung_exynos9610_mint/releases/download/xbeta-1413_a50dx/MintBeta-1413.A11.AOSP-Enforcing-KSU_A50.CI.zip"

      - name: Force OverlayFS for Action Button
        run: |
          unzip kernel.zip -d work_dir
          cd work_dir
          # تعديل AnyKernel3 لإجبار النظام على تفعيل OverlayFS وحل خطأ Function not implemented
          sed -i 's/do.devicecheck=1/do.devicecheck=0/g' anykernel.sh
          echo "patch_overlayfs=1" >> anykernel.sh
          echo "ksu_webui=true" >> anykernel.sh
          # أمر إضافي لضمان عمل الـ Action وزر التحديث
          echo "force_overlayfs=1" >> anykernel.sh
          
          zip -r9 ../A50-KSU-ACTION-FIX.zip *

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: A50-KSU-ACTION-READY
          path: A50-KSU-ACTION-FIX.zip
